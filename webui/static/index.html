<!DOCTYPE html>
<html lang="en" data-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iTaK - Dashboard</title>
    <meta name="description" content="iTaK Intelligent Task Automation Kernel - Agent Monitoring Dashboard">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="/style.css">
</head>

<body>
    <!-- Top Bar -->
    <header class="topbar">
        <div class="topbar-brand">
            <h1>ğŸ§  iTaK</h1>
            <span style="font-size:12px; color:var(--text-muted)">Intelligent Task Automation Kernel</span>
        </div>
        <div class="topbar-status">
            <div class="status-dot" id="statusDot"></div>
            <span id="statusText">Connecting...</span>
        </div>
    </header>

    <!-- Tab Navigation -->
    <nav class="tab-bar">
        <button class="tab-btn active" data-tab="monitor" onclick="switchTab('monitor')">ğŸ“Š Monitor</button>
        <button class="tab-btn" data-tab="mission" onclick="switchTab('mission')">ğŸ“‹ Mission Control</button>
        <button class="tab-btn" data-tab="tools" onclick="switchTab('tools')">ğŸ”§ Tools</button>
        <button class="tab-btn" data-tab="logs" onclick="switchTab('logs')">ğŸ“‹ Logs</button>
        <button class="tab-btn" data-tab="subsystems" onclick="switchTab('subsystems')">âš™ï¸ Subsystems</button>
        <button class="tab-btn" data-tab="users" onclick="switchTab('users')">ğŸ‘¥ Users</button>
        <button class="tab-btn" data-tab="heartbeat" onclick="switchTab('heartbeat')">ğŸ’“ Heartbeat</button>
        <button class="tab-btn" data-tab="webhooks" onclick="switchTab('webhooks')">ğŸ”— Webhooks</button>
        <button class="tab-btn" data-tab="swarm" onclick="switchTab('swarm')">ğŸ Swarm</button>
        <button class="tab-btn" data-tab="mcp" onclick="switchTab('mcp')">ğŸ”Œ MCP</button>
        <button class="tab-btn" data-tab="config" onclick="switchTab('config')">âš™ï¸ Config</button>
    </nav>

    <!-- ==================== MONITOR TAB ==================== -->
    <main class="tab-content active" id="tab-monitor">
        <div class="dashboard">
            <!-- Stats Row -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">Agent Overview</span>
                    <span class="card-icon">ğŸ“Š</span>
                </div>
                <div class="stat-grid">
                    <div class="stat-box">
                        <div class="stat-label">Uptime</div>
                        <div class="stat-value green" id="statUptime">--</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Tools</div>
                        <div class="stat-value blue" id="statTools">--</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Iterations</div>
                        <div class="stat-value purple" id="statIterations">--</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Budget Left</div>
                        <div class="stat-value amber" id="statBudget">--</div>
                    </div>
                </div>
            </div>

            <!-- Memory Stats -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">Memory Layers</span>
                    <span class="card-icon">ğŸ§ </span>
                </div>
                <div class="stat-grid">
                    <div class="stat-box">
                        <div class="stat-label">Markdown</div>
                        <div class="stat-value cyan" id="memMarkdown">--</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">SQLite</div>
                        <div class="stat-value blue" id="memSqlite">--</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Neo4j</div>
                        <div class="stat-value purple" id="memNeo4j">--</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Weaviate</div>
                        <div class="stat-value green" id="memWeaviate">--</div>
                    </div>
                </div>
            </div>

            <!-- Live Log Stream -->
            <div class="card" style="grid-column: span 2;">
                <div class="card-header">
                    <span class="card-title">Live Log Stream</span>
                    <span class="card-icon">ğŸ“‹</span>
                </div>
                <div class="log-stream" id="logStream">
                    <div class="log-entry">
                        <span class="log-time">--:--</span>
                        <span class="log-type system">system</span>
                        <span class="log-data">Waiting for connection...</span>
                    </div>
                </div>
            </div>

            <!-- Chat Panel -->
            <div class="card chat-panel">
                <div class="card-header">
                    <span class="card-title">Chat with iTaK</span>
                    <span class="card-icon">ğŸ’¬</span>
                </div>
                <div class="chat-messages" id="chatMessages">
                    <div class="chat-msg agent">ğŸ‘‹ Hello! I'm iTaK. Send me a task or question.</div>
                </div>
                <div class="chat-input-row">
                    <input type="text" class="chat-input" id="chatInput" placeholder="Type your message..."
                        autocomplete="off">
                    <button class="chat-btn" id="chatSendBtn" onclick="sendChat()">Send</button>
                </div>
            </div>

            <!-- Memory Search -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">Memory Search</span>
                    <span class="card-icon">ğŸ”</span>
                </div>
                <div class="memory-search-row">
                    <input type="text" class="chat-input" id="memoryInput" placeholder="Search memories..."
                        autocomplete="off">
                    <button class="chat-btn" onclick="searchMemory()">Search</button>
                </div>
                <div class="memory-results" id="memoryResults"></div>
            </div>
        </div>
    </main>

    <!-- ==================== MISSION CONTROL TAB ==================== -->
    <main class="tab-content" id="tab-mission">
        <!-- Board Stats Bar -->
        <div class="mc-stats-bar">
            <div class="mc-stat"><span class="mc-stat-value" id="mcTotal">0</span><span
                    class="mc-stat-label">Total</span></div>
            <div class="mc-stat"><span class="mc-stat-value inbox-color" id="mcInbox">0</span><span
                    class="mc-stat-label">Inbox</span></div>
            <div class="mc-stat"><span class="mc-stat-value progress-color" id="mcProgress">0</span><span
                    class="mc-stat-label">In Progress</span></div>
            <div class="mc-stat"><span class="mc-stat-value review-color" id="mcReview">0</span><span
                    class="mc-stat-label">Review</span></div>
            <div class="mc-stat"><span class="mc-stat-value done-color" id="mcDone">0</span><span
                    class="mc-stat-label">Done</span></div>
            <button class="chat-btn mc-new-btn" onclick="openNewTaskModal()">+ New Task</button>
        </div>

        <!-- Kanban Board -->
        <div class="kanban-board">
            <div class="kanban-column" data-status="inbox">
                <div class="kanban-col-header">
                    <span class="kanban-col-icon">ğŸ“¥</span>
                    <span class="kanban-col-title">INBOX</span>
                    <span class="kanban-col-count" id="colCount-inbox">0</span>
                </div>
                <div class="kanban-cards" id="col-inbox" ondragover="allowDrop(event)"
                    ondrop="dropTask(event, 'inbox')"></div>
            </div>
            <div class="kanban-column" data-status="in_progress">
                <div class="kanban-col-header">
                    <span class="kanban-col-icon">ğŸ”„</span>
                    <span class="kanban-col-title">IN PROGRESS</span>
                    <span class="kanban-col-count" id="colCount-in_progress">0</span>
                </div>
                <div class="kanban-cards" id="col-in_progress" ondragover="allowDrop(event)"
                    ondrop="dropTask(event, 'in_progress')"></div>
            </div>
            <div class="kanban-column" data-status="review">
                <div class="kanban-col-header">
                    <span class="kanban-col-icon">ğŸ‘€</span>
                    <span class="kanban-col-title">REVIEW</span>
                    <span class="kanban-col-count" id="colCount-review">0</span>
                </div>
                <div class="kanban-cards" id="col-review" ondragover="allowDrop(event)"
                    ondrop="dropTask(event, 'review')"></div>
            </div>
            <div class="kanban-column" data-status="done">
                <div class="kanban-col-header">
                    <span class="kanban-col-icon">âœ…</span>
                    <span class="kanban-col-title">DONE</span>
                    <span class="kanban-col-count" id="colCount-done">0</span>
                </div>
                <div class="kanban-cards" id="col-done" ondragover="allowDrop(event)" ondrop="dropTask(event, 'done')">
                </div>
            </div>
        </div>
    </main>

    <!-- ==================== TOOLS TAB ==================== -->
    <main class="tab-content" id="tab-tools">
        <div class="dashboard">
            <div class="card" style="grid-column: span 2;">
                <div class="card-header">
                    <span class="card-title">Loaded Tools</span>
                    <span class="card-icon">ğŸ”§</span>
                </div>
                <div id="toolsList" class="tools-list">
                    <div style="color:var(--text-muted);padding:20px;">Loading tools...</div>
                </div>
            </div>
        </div>
    </main>

    <!-- ==================== LOGS TAB ==================== -->
    <main class="tab-content" id="tab-logs">
        <div class="dashboard">
            <div class="card" style="grid-column: span 2;">
                <div class="card-header">
                    <span class="card-title">Event Logs</span>
                    <span class="card-icon">ğŸ“‹</span>
                </div>
                <div class="logs-controls">
                    <input type="text" class="chat-input" id="logsSearch" placeholder="Search logs..." style="flex:1;">
                    <button class="chat-btn" onclick="loadLogs()">Search</button>
                    <button class="chat-btn" onclick="clearLogsSearch()">Clear</button>
                </div>
                <div id="logsContainer" class="log-stream" style="max-height:600px;overflow-y:auto;">
                    <div style="color:var(--text-muted);padding:20px;">Loading logs...</div>
                </div>
            </div>
        </div>
    </main>

    <!-- ==================== SUBSYSTEMS TAB ==================== -->
    <main class="tab-content" id="tab-subsystems">
        <div class="dashboard">
            <div class="card" style="grid-column: span 2;">
                <div class="card-header">
                    <span class="card-title">Subsystem Health</span>
                    <span class="card-icon">âš™ï¸</span>
                </div>
                <div id="subsystemsList" class="subsystems-list">
                    <div style="color:var(--text-muted);padding:20px;">Loading subsystems...</div>
                </div>
            </div>
        </div>
    </main>

    <!-- ==================== USERS TAB ==================== -->
    <main class="tab-content" id="tab-users">
        <div class="dashboard">
            <div class="card" style="grid-column: span 2;">
                <div class="card-header">
                    <span class="card-title">User Management</span>
                    <span class="card-icon">ğŸ‘¥</span>
                </div>
                <div style="margin-bottom:16px;">
                    <button class="chat-btn" onclick="openAddUserModal()">+ Add User</button>
                </div>
                <div id="usersList" class="users-list">
                    <div style="color:var(--text-muted);padding:20px;">Loading users...</div>
                </div>
            </div>
        </div>
    </main>

    <!-- ==================== HEARTBEAT TAB ==================== -->
    <main class="tab-content" id="tab-heartbeat">
        <div class="dashboard">
            <div class="card">
                <div class="card-header">
                    <span class="card-title">Uptime Statistics</span>
                    <span class="card-icon">â±ï¸</span>
                </div>
                <div id="heartbeatUptime" class="stats-display">
                    <div style="color:var(--text-muted);padding:20px;">Loading...</div>
                </div>
            </div>
            <div class="card">
                <div class="card-header">
                    <span class="card-title">Health Check History</span>
                    <span class="card-icon">ğŸ’“</span>
                </div>
                <div id="heartbeatHistory" class="heartbeat-history">
                    <div style="color:var(--text-muted);padding:20px;">Loading...</div>
                </div>
            </div>
        </div>
    </main>

    <!-- ==================== WEBHOOKS TAB ==================== -->
    <main class="tab-content" id="tab-webhooks">
        <div class="dashboard">
            <div class="card" style="grid-column: span 2;">
                <div class="card-header">
                    <span class="card-title">Webhook Statistics</span>
                    <span class="card-icon">ğŸ”—</span>
                </div>
                <div id="webhooksStats" class="stats-grid">
                    <div style="color:var(--text-muted);padding:20px;">Loading...</div>
                </div>
            </div>
        </div>
    </main>

    <!-- ==================== SWARM TAB ==================== -->
    <main class="tab-content" id="tab-swarm">
        <div class="dashboard">
            <div class="card">
                <div class="card-header">
                    <span class="card-title">Swarm Statistics</span>
                    <span class="card-icon">ğŸ“Š</span>
                </div>
                <div id="swarmStats" class="stats-display">
                    <div style="color:var(--text-muted);padding:20px;">Loading...</div>
                </div>
            </div>
            <div class="card">
                <div class="card-header">
                    <span class="card-title">Agent Profiles</span>
                    <span class="card-icon">ğŸ</span>
                </div>
                <div id="swarmProfiles" class="profiles-list">
                    <div style="color:var(--text-muted);padding:20px;">Loading...</div>
                </div>
            </div>
        </div>
    </main>

    <!-- ==================== MCP TAB ==================== -->
    <main class="tab-content" id="tab-mcp">
        <div class="dashboard">
            <div class="card">
                <div class="card-header">
                    <span class="card-title">MCP Server Status</span>
                    <span class="card-icon">ğŸ”Œ</span>
                </div>
                <div id="mcpStatus" class="stats-display">
                    <div style="color:var(--text-muted);padding:20px;">Loading...</div>
                </div>
            </div>
            <div class="card">
                <div class="card-header">
                    <span class="card-title">MCP Server Health</span>
                    <span class="card-icon">ğŸ’š</span>
                </div>
                <div id="mcpHealth" class="stats-display">
                    <div style="color:var(--text-muted);padding:20px;">Loading...</div>
                </div>
            </div>
        </div>
    </main>

    <!-- ==================== CONFIG TAB ==================== -->
    <main class="tab-content" id="tab-config">
        <div class="dashboard">
            <div class="card" style="grid-column: span 2;">
                <div class="card-header">
                    <span class="card-title">Configuration (Secrets Masked)</span>
                    <span class="card-icon">âš™ï¸</span>
                </div>
                <div id="configViewer" class="config-viewer">
                    <div style="color:var(--text-muted);padding:20px;">Loading...</div>
                </div>
            </div>
        </div>
    </main>

    <!-- New Task Modal -->
    <div class="modal-overlay" id="newTaskModal" onclick="closeModal(event)">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h2>Create New Task</h2>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <form onsubmit="createTask(event)">
                <label class="form-label">Title</label>
                <input type="text" class="form-input" id="newTaskTitle" required placeholder="Task title...">
                <label class="form-label">Description</label>
                <textarea class="form-input form-textarea" id="newTaskDesc"
                    placeholder="What needs to be done..."></textarea>
                <label class="form-label">Priority</label>
                <select class="form-input" id="newTaskPriority">
                    <option value="low">ğŸŸ¢ Low</option>
                    <option value="medium" selected>ğŸŸ¡ Medium</option>
                    <option value="high">ğŸŸ  High</option>
                    <option value="critical">ğŸ”´ Critical</option>
                </select>
                <button type="submit" class="chat-btn" style="width:100%;margin-top:16px;">Create Task</button>
            </form>
        </div>
    </div>

    <!-- Add User Modal -->
    <div class="modal-overlay" id="addUserModal" onclick="closeAddUserModal(event)">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h2>Add User</h2>
                <button class="modal-close" onclick="closeAddUserModal()">&times;</button>
            </div>
            <form onsubmit="addUser(event)">
                <label class="form-label">Username</label>
                <input type="text" class="form-input" id="newUserUsername" required placeholder="username">
                <label class="form-label">Role</label>
                <select class="form-input" id="newUserRole">
                    <option value="user">User</option>
                    <option value="admin">Admin</option>
                    <option value="owner">Owner</option>
                </select>
                <button type="submit" class="chat-btn" style="width:100%;margin-top:16px;">Add User</button>
            </form>
        </div>
    </div>

    <script src="/app.js"></script>
</body>

</html>