<html>
<head>
    <title>Import Skills</title>
    <script type="module">
        import { store } from "/components/settings/skills/skills-import-store.js";
    </script>
</head>
<body>
    <div x-data>
        <template x-if="$store.skillsImportStore">
            <div x-init="$store.skillsImportStore.init()" x-destroy="$store.skillsImportStore.onClose()">

                <h3>Import Skills (SKILL.md)</h3>

                <div class="warning-banner">
                    Importing third-party skills can include prompt-injection instructions. Review source trust, inspect preview output, and confirm review summary before install.
                </div>

                <div class="upload-section">
                    <label for="skills-file" class="upload-label">
                        Select Skills Pack (.zip)
                    </label>
                    <input type="file" id="skills-file" accept=".zip"
                        @change="$store.skillsImportStore.handleFileUpload($event)">
                    <div class="upload-hint">
                        Upload a repository/archive that contains SKILL.md skill folders (see agentskills.io).
                    </div>
                </div>

                <div class="options" x-show="$store.skillsImportStore.skillsFile">
                    <label class="policy-label">
                        <span class="policy-label-text">Limit to project:</span>
                        <select x-model="$store.skillsImportStore.projectKey" class="policy-dropdown"
                            @change="$store.skillsImportStore.previewImport()">
                            <option value="">All</option>
                            <template x-for="project in $store.skillsImportStore.projects" :key="project.key">
                                <option :value="project.key" x-text="project.label"></option>
                            </template>
                        </select>
                    </label>

                    <label class="policy-label">
                        <span class="policy-label-text">Limit to agent profile:</span>
                        <select x-model="$store.skillsImportStore.agentProfileKey" class="policy-dropdown"
                            @change="$store.skillsImportStore.previewImport()">
                            <option value="">All</option>
                            <template x-for="agentProfile in $store.skillsImportStore.agentProfiles" :key="agentProfile.key">
                                <option :value="agentProfile.key" x-text="agentProfile.label"></option>
                            </template>
                        </select>
                    </label>

                    <label class="policy-label">
                        <span class="policy-label-text">Namespace:</span>
                        <input class="text-input" type="text" placeholder="e.g. my-pack"
                            x-model="$store.skillsImportStore.namespace"
                            @change="$store.skillsImportStore.previewImport()">
                    </label>

                    <label class="policy-label">
                        <span class="policy-label-text">Conflict policy:</span>
                        <select x-model="$store.skillsImportStore.conflict" class="policy-dropdown"
                            @change="$store.skillsImportStore.previewImport()">
                            <option value="skip">Skip existing</option>
                            <option value="rename">Rename (add _2, _3...)</option>
                            <option value="overwrite">Overwrite existing</option>
                        </select>
                    </label>

                    <label class="policy-label">
                        <span class="policy-label-text">Source URL (optional):</span>
                        <input class="text-input" type="text" placeholder="https://trusted.example/skills-pack"
                            x-model="$store.skillsImportStore.sourceUrl"
                            @change="$store.skillsImportStore.previewImport()">
                    </label>

                    <label class="policy-label policy-label-stacked">
                        <span class="policy-label-text">Review summary (required for import):</span>
                        <textarea class="text-input" rows="3"
                            placeholder="What you reviewed and why this pack is safe to enable"
                            x-model="$store.skillsImportStore.reviewSummary"></textarea>
                    </label>

                    <div class="buttons">
                        <button class="btn slim" @click="$store.skillsImportStore.previewImport()"
                            :disabled="$store.skillsImportStore.loading">Preview</button>
                        <button class="btn slim primary" @click="$store.skillsImportStore.performImport()"
                            :disabled="$store.skillsImportStore.loading">Import</button>
                        <button class="btn slim" @click="$store.skillsImportStore.exportSkillsPack()"
                            :disabled="$store.skillsImportStore.loading">Export</button>
                    </div>
                </div>

                <div x-show="$store.skillsImportStore.loading" class="loading">
                    <span x-text="$store.skillsImportStore.loadingMessage || 'Processing...'"></span>
                </div>

                <div x-show="$store.skillsImportStore.error" class="error">
                    <span x-text="$store.skillsImportStore.error"></span>
                </div>

                <div x-show="$store.skillsImportStore.preview" class="preview">
                    <h4>Preview</h4>
                    <div class="preview-meta">
                        <div>Namespace: <code x-text="$store.skillsImportStore.preview?.namespace"></code></div>
                        <div>Would import: <span x-text="$store.skillsImportStore.preview?.imported_count || 0"></span></div>
                        <div>Would skip: <span x-text="$store.skillsImportStore.preview?.skipped_count || 0"></span></div>
                    </div>

                    <textarea class="preview-list" readonly
                        x-text="($store.skillsImportStore.preview?.imported || []).join('\n')"></textarea>
                </div>

                <div x-show="$store.skillsImportStore.result" class="result">
                    <h4>Import Complete</h4>
                    <div class="preview-meta">
                        <div>Imported: <span x-text="$store.skillsImportStore.result?.imported_count || 0"></span></div>
                        <div>Skipped: <span x-text="$store.skillsImportStore.result?.skipped_count || 0"></span></div>
                        <div>Rejected: <span x-text="$store.skillsImportStore.result?.rejected_count || 0"></span></div>
                    </div>
                    <div class="note">
                        Skills are indexed automatically. If you donâ€™t see them immediately, use the Restart button in the left pane.
                    </div>
                </div>

                <div class="create-skill-section">
                    <h4>Create Skill from Notes</h4>
                    <div class="section-description">
                        Turn ad-hoc notes into a reusable SKILL.md with preview and one-click install.
                    </div>

                    <label class="policy-label">
                        <span class="policy-label-text">Skill title:</span>
                        <input class="text-input" type="text" placeholder="Incident response checklist"
                            x-model="$store.skillsImportStore.createTitle">
                    </label>

                    <label class="policy-label policy-label-stacked">
                        <span class="policy-label-text">Source notes:</span>
                        <textarea class="text-input" rows="6" placeholder="Paste docs or notes here"
                            x-model="$store.skillsImportStore.createSourceText"></textarea>
                    </label>

                    <div class="buttons">
                        <button class="btn slim" @click="$store.skillsImportStore.previewCreateSkill()"
                            :disabled="$store.skillsImportStore.loading">Preview Skill</button>
                        <button class="btn slim primary" @click="$store.skillsImportStore.installCreatedSkill()"
                            :disabled="$store.skillsImportStore.loading">Install Skill</button>
                    </div>

                    <textarea class="preview-list" readonly x-show="$store.skillsImportStore.createPreview"
                        x-text="$store.skillsImportStore.createPreview"></textarea>

                    <div class="note" x-show="$store.skillsImportStore.createResult">
                        Installed as <code x-text="$store.skillsImportStore.createResult?.name"></code>
                        at <code x-text="$store.skillsImportStore.createResult?.path"></code>
                    </div>
                </div>

            </div>
        </template>
    </div>

    <style>
        .upload-section {
            margin-bottom: 1rem;
            padding: 1rem;
            border: 2px dashed var(--color-border);
            border-radius: 4px;
            text-align: center;
        }

        .upload-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .upload-hint {
            margin-top: 0.5rem;
            font-size: 0.85rem;
            color: var(--color-secondary);
        }

        .options {
            margin: 1rem 0;
            padding: 0.75rem;
            background: var(--color-input);
            border: 1px solid var(--color-border);
            border-radius: 4px;
        }

        .warning-banner {
            margin: 0.75rem 0;
            padding: 0.75rem;
            border: 1px solid var(--color-warning, #f5b800);
            border-radius: 4px;
            background: var(--color-warning-bg, rgba(245, 184, 0, 0.08));
            font-size: 0.9rem;
        }

        .policy-label {
            display: grid;
            grid-template-columns: minmax(10rem, 14rem) 1fr;
            align-items: center;
            column-gap: 0.75rem;
            row-gap: 0.25rem;
            margin: 0.5rem 0;
        }

        .policy-label-stacked {
            grid-template-columns: 1fr;
        }

        .policy-label-text {
            font-weight: 600;
            white-space: normal;
            width: auto;
        }

        .policy-dropdown, .text-input {
            flex: 1;
            padding: 0.5rem;
            border: 1px solid var(--color-border);
            border-radius: 4px;
            background: var(--color-bg-primary);
            color: var(--color-text-primary);
            font-size: 0.9rem;
        }

        .buttons {
            margin-top: 0.75rem;
            display: flex;
            gap: 0.5rem;
        }

        .loading {
            width: 100%;
            text-align: center;
            margin-top: 1rem;
            margin-bottom: 1rem;
            color: var(--color-secondary);
        }

        .error {
            color: var(--color-error);
            margin: 0.5rem 0;
            padding: 0.5rem;
            background: var(--color-error-bg);
            border-radius: 4px;
        }

        .preview, .result {
            margin-top: 1rem;
            padding: 0.75rem;
            background: var(--color-bg-primary);
            border: 1px solid var(--color-border);
            border-radius: 4px;
        }

        .create-skill-section {
            margin-top: 1rem;
            padding: 0.75rem;
            border: 1px solid var(--color-border);
            border-radius: 4px;
            background: var(--color-bg-primary);
        }

        .preview-meta {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.25rem 1rem;
            margin-bottom: 0.5rem;
            color: var(--color-text-secondary);
            font-size: 0.9rem;
        }

        .preview-list {
            width: 100%;
            height: 12em;
            font-family: monospace;
            font-size: 0.85em;
            background: var(--color-bg-primary);
            color: var(--color-text-primary);
            border: 1px solid var(--color-border);
            border-radius: 4px;
            padding: 0.5em;
            resize: vertical;
        }

        .note {
            margin-top: 0.5rem;
            font-size: 0.9rem;
            color: var(--color-text-secondary);
        }

        @media (max-width: 700px) {
            .policy-label {
                grid-template-columns: 1fr;
            }

            .policy-label-text {
                width: auto;
                white-space: normal;
            }
        }
    </style>
</body>
</html>

